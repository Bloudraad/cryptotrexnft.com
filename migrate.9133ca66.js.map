{"mappings":"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","sources":["js/migrate.js"],"sourcesContent":["import os from './contracts/ERC1155Test.json';\nimport ct from './contracts/CryptoTrex.json';\nimport { config } from './config';\nimport { loadWeb3, web3Address, switchChain } from './web3.js';\n\nasync function render(address, web3) {\n  const approved = await isApproved(web3, address);\n  if (approved) {\n    await renderItems(address, web3);\n  } else {\n    await renderApprovalPrompt();\n  }\n}\n\nasync function batchMigrate(ids) {\n  const web3 = await loadWeb3();\n  const address = await web3Address(web3);\n  const chainId = await web3.eth.getChainId();\n  let tokenIds = [];\n  ids.forEach((id) => {\n    tokenIds.push(web3.utils.toBN(id));\n  });\n  if (tokenIds.length < 1) return;\n  const c = new web3.eth.Contract(ct.abi, config[chainId].migration_address);\n  const batchMigrateBtn = document.getElementById('batchMigrateBtn');\n  c.methods\n    .migrateBatch(tokenIds)\n    .send({ from: address })\n    .on('receipt', () => {\n      batchMigrateBtn.disabled = true;\n      batchMigrateBtn.textContent = 'Migrated';\n      batchMigrateBtn.classList = 'nes-btn is-success';\n    })\n    .on('transactionHash', (hash) => {\n      batchMigrateBtn.textContent = 'Migrating...';\n      batchMigrateBtn.classList = 'nes-btn';\n      batchMigrateBtn.addEventListener('click', () => {\n        window.open(`https://etherscan.io/tx/${hash}`, '_blank').focus();\n      });\n    })\n    .on('error', () => {\n      batchMigrateBtn.disabled = true;\n      batchMigrateBtn.textContent = 'Failed';\n      batchMigrateBtn.classList = 'nes-btn is-error';\n    });\n}\n\nasync function isApproved(web3, address) {\n  const chainId = await web3.eth.getChainId();\n  const osc = new web3.eth.Contract(os.abi, config[chainId].origin_address);\n  return await osc.methods\n    .isApprovedForAll(address, config[chainId].migration_address)\n    .call({ from: address });\n}\n\nasync function approve() {\n  const web3 = await loadWeb3();\n  const address = await web3Address(web3);\n  const chainId = await web3.eth.getChainId();\n  const osc = new web3.eth.Contract(os.abi, config[chainId].origin_address);\n  osc.methods\n    .setApprovalForAll(config[chainId].migration_address, true)\n    .send({ from: address })\n    .on('receipt', () => {\n      const approveBtn = document.getElementById('approveBtn');\n      approveBtn.textContent = 'Approved';\n      approveBtn.disabled = true;\n      approveBtn.classList = 'nes-btn is-success is-disabled';\n      renderItems(address, web3);\n    })\n    .on('transactionHash', (hash) => {\n      const container = document.getElementById('approvalContainer');\n      const viewTx = document.createElement('a');\n      viewTx.classList = 'nes-btn';\n      viewTx.href = `https://etherscan.io/tx/${hash}`;\n      viewTx.target = '_blank';\n      viewTx.text = 'View Transaction';\n      container.appendChild(viewTx);\n\n      const approveBtn = document.getElementById('approveBtn');\n      approveBtn.textContent = 'Approving...';\n      approveBtn.disabled = true;\n      approveBtn.classList = 'nes-btn is-primary';\n    });\n}\n\nasync function migrate(id, btn) {\n  const web3 = await loadWeb3();\n  const address = await web3Address(web3);\n  const chainId = await web3.eth.getChainId();\n  const tokenId = web3.utils.toBN(id);\n\n  const c = new web3.eth.Contract(ct.abi, config[chainId].migration_address);\n  c.methods\n    .migrate(tokenId)\n    .send({ from: address })\n    .on('receipt', () => {\n      btn.disabled = true;\n      btn.classList = 'nes-btn is-success';\n      btn.textContent = 'Migrated';\n    })\n    .on('transactionHash', (hash) => {\n      btn.textContent = 'Migrating...';\n      btn.addEventListener('click', () => {\n        window.open(`https://etherscan.io/tx/${hash}`, '_blank').focus();\n      });\n    })\n    .on('error', () => {\n      btn.disabled = true;\n      btn.textContent = 'Failed';\n      btn.classList = 'nes-btn is-error';\n    });\n}\n\nasync function addToken(eth) {\n  const web3 = await loadWeb3();\n  const chainId = await web3.eth.getChainId();\n\n  const tokenAddress = config[chainId].token_address;\n  const tokenSymbol = 'FOSSIL';\n  const tokenDecimals = 18;\n  const tokenImage =\n    'https://gateway.pinata.cloud/ipfs/QmZpPpnuASN7riY1UwVftSMowJAgMbf9x1k9pCaH5buSEQ';\n\n  try {\n    // wasAdded is a boolean. Like any RPC method, an error may be thrown.\n    await eth.request({\n      method: 'wallet_watchAsset',\n      params: {\n        type: 'ERC20', // Initially only supports ERC20, but eventually more!\n        options: {\n          address: tokenAddress, // The address that the token is at.\n          symbol: tokenSymbol, // A ticker symbol or shorthand, up to 5 chars.\n          decimals: tokenDecimals, // The number of decimals in the token\n          image: tokenImage, // A string url of the token logo\n        },\n      },\n    });\n  } catch (error) {\n    console.log(error);\n  }\n}\nlet itemIds = [];\n\nasync function getV1Items(address, opensea, oldCollection) {\n  const url = `${opensea}/api/v1/assets?offset=0&limit=50&collection=${oldCollection}&owner=${address}`;\n  const res = await fetch(url);\n  const body = await res.json();\n  return body.assets;\n}\n\nasync function getV2Items(address, opensea, newCollection) {\n  const url = `${opensea}/api/v1/assets?offset=0&limit=50&collection=${newCollection}&owner=${address}`;\n  const res = await fetch(url);\n  const body = await res.json();\n  return body.assets;\n}\n\nasync function renderApprovalPrompt() {\n  const apprView = document.getElementById('approvalView');\n  const migrView = document.getElementById('migrationView');\n  apprView.hidden = false;\n  migrView.hidden = true;\n\n  const web3 = await loadWeb3();\n  const address = await web3Address(web3);\n  const chainId = await web3.eth.getChainId();\n  const v1 = await getV1Items(\n    address,\n    config[chainId].opensea_api,\n    config[chainId].old_collection,\n  );\n\n  if (v1.length < 1) {\n    const warning = document.getElementById('warningNoTrex');\n    warning.hidden = false;\n  }\n}\n\nasync function renderItems(address, web3) {\n  const apprView = document.getElementById('approvalView');\n  const migrView = document.getElementById('migrationView');\n  apprView.hidden = true;\n  migrView.hidden = false;\n  const chainId = await web3.eth.getChainId();\n  const v1 = await getV1Items(\n    address,\n    config[chainId].opensea_api,\n    config[chainId].old_collection,\n  );\n  const v2 = await getV2Items(\n    address,\n    config[chainId].opensea_api,\n    config[chainId].new_collection,\n  );\n\n  const list = document.querySelector('#card-list');\n  if (web3.currentProvider.isMetaMask) {\n    const addTokenBtn = document.getElementById('addTokenBtn');\n    addTokenBtn.hidden = false;\n  }\n\n  if (v1.length < 1) {\n    const batchMigrateBtn = document.getElementById('batchMigrateBtn');\n    batchMigrateBtn.textContent = 'Nothing to migrate';\n    batchMigrateBtn.classList = 'nes-btn is-disabled';\n    batchMigrateBtn.disabled = true;\n  }\n\n  if (v1) {\n    const c = new web3.eth.Contract(os.abi, config[chainId].origin_address);\n    v1.forEach(async (e) => {\n      itemIds.push(e.token_id);\n      const balance = await c.methods\n        .balanceOf(address, e.token_id)\n        .call({ from: address });\n      if (balance && balance > 0) {\n        list.appendChild(buildCard(e, false));\n      }\n    });\n  }\n\n  if (v2) {\n    v2.forEach((e) => {\n      list.appendChild(buildCard(e, true));\n    });\n  }\n}\n\nfunction buildCard(e, migrated) {\n  const card = document.createElement('div');\n  card.classList = 'nes-container item-card is-rounded';\n  card.style = 'background-color: white; display: block;';\n  const imageContainer = document.createElement('a');\n  imageContainer.classList = 'nes-container is-rounded';\n  imageContainer.href = e.permalink;\n  imageContainer.target = '_blank';\n  imageContainer.style =\n    'background-color: white; padding: 0px !important; display: flex; justify-content: center';\n  const image = document.createElement('img');\n  image.src = e.image_thumbnail_url;\n  image.crossOrigin = 'anonymous';\n  image.style.width = '100%';\n  imageContainer.appendChild(image);\n  const nameDiv = document.createElement('p');\n  nameDiv.classList.add('pt-1');\n  nameDiv.textContent = e.name;\n  const migrateBtn = document.createElement('button');\n  migrateBtn.type = 'button';\n\n  if (!migrated) {\n    migrateBtn.classList = 'nes-btn';\n    migrateBtn.textContent = 'Migrate';\n  } else {\n    migrateBtn.classList = 'nes-btn is-disabled';\n    migrateBtn.disabled = true;\n    migrateBtn.textContent = 'Migrated';\n  }\n  migrateBtn.style = 'width: 100%';\n  migrateBtn.addEventListener('click', () => migrate(e.token_id, migrateBtn));\n  card.appendChild(imageContainer);\n  card.appendChild(nameDiv);\n  card.appendChild(migrateBtn);\n\n  const cardContainer = document.createElement('div');\n  cardContainer.classList.add('col-md-3', 'col-xs-6', 'pb-1');\n  cardContainer.appendChild(card);\n\n  return cardContainer;\n}\n\nconst batchMigrateBtn = document.getElementById('batchMigrateBtn');\nbatchMigrateBtn.addEventListener('click', async () => {\n  await batchMigrate(itemIds);\n});\n\nwindow.onload = async ()=>{\n  try {\n    const web3 = await loadWeb3();\n    const address = await web3Address(web3);\n    switchChain(window.ethereum);\n    render(address, web3);\n  } catch(err) {\n    console.log(err);\n  }\n};\n\nconst addTokenBtn = document.getElementById('addTokenBtn');\naddTokenBtn.addEventListener('click', async () => {\n  await addToken(window.ethereum);\n});\n\nconst approveBtn = document.getElementById('approveBtn');\napproveBtn.addEventListener('click', async () => {\n  await approve();\n});\n"],"names":["$56cd91b74de0ab6d$var$render","address","web3","approved","chainId","eth","getChainId","osc","Contract","$parcel$interopDefault","$cSnus","abi","$71KSP","config","origin_address","methods","isApprovedForAll","migration_address","call","from","$56cd91b74de0ab6d$var$isApproved","$56cd91b74de0ab6d$var$renderItems","apprView","document","getElementById","migrView","hidden","$7VRcZ","loadWeb3","web3Address","$56cd91b74de0ab6d$var$getV1Items","opensea_api","old_collection","length","$56cd91b74de0ab6d$var$renderApprovalPrompt","$56cd91b74de0ab6d$var$itemIds","opensea","oldCollection","url","res","fetch","json","assets","v1","v2","newCollection","$56cd91b74de0ab6d$var$getV2Items","new_collection","list","querySelector","currentProvider","isMetaMask","batchMigrateBtn","textContent","classList","disabled","c","forEach","async","e","push","token_id","balance","balanceOf","appendChild","$56cd91b74de0ab6d$var$buildCard","migrated","card","createElement","style","imageContainer","href","permalink","target","image","src","image_thumbnail_url","crossOrigin","width","nameDiv","add","name","migrateBtn","type","addEventListener","id","btn","tokenId","utils","toBN","$2tNqr","migrate","send","on","hash","window","open","focus","$56cd91b74de0ab6d$var$migrate","cardContainer","ids","tokenIds","migrateBatch","$56cd91b74de0ab6d$var$batchMigrate","onload","switchChain","ethereum","err","console","log","tokenAddress","token_address","request","method","params","options","symbol","decimals","error","$56cd91b74de0ab6d$var$addToken","setApprovalForAll","approveBtn","container","viewTx","text","$56cd91b74de0ab6d$var$approve"],"version":3,"file":"migrate.9133ca66.js.map"}